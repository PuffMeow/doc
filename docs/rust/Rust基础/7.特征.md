---
title: ç‰¹å¾
---

## Trait(ç‰¹å¾)

è¿™ä¸ªä¹Ÿæ˜¯ Rust ä¸­æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚

- Trait å¯ä»¥å‘Šè¯‰ç¼–è¯‘å™¨æŸç§ç±»å‹å…·æœ‰å“ªäº›å¹¶ä¸”å¯ä»¥å’Œå…¶å®ƒç±»å‹å…±äº«çš„åŠŸèƒ½
- æŠ½è±¡çš„å®šä¹‰å…±äº«è¡Œä¸º
- Trait bounds(çº¦æŸ): æ³›å‹ç±»å‹å‚æ•°æŒ‡å®šä¸ºå®ç°äº†ç‰¹å®šè¡Œä¸ºçš„ç±»å‹
- **Trait å…¶å®å’Œå…¶å®ƒè¯­è¨€çš„æ¥å£ interface å¾ˆåƒï¼Œä½†åˆæœ‰åŒºåˆ«**

## å®šä¹‰ Trait

æŠŠæ–¹æ³•ç­¾åæ”¾ä¸€èµ·ï¼Œæ¥å®šä¹‰å®ç°æŸç§ç›®çš„æ‰€å¿…éœ€çš„ä¸€ç»„è¡Œä¸º

- åªæœ‰æ–¹æ³•ç­¾åï¼Œæ²¡æœ‰å…·ä½“å®ç°
- å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å ä¸€è¡Œï¼Œä»¥åˆ†å·;ç»“å°¾
- å®ç°è¯¥ Trait çš„ç±»å‹å¿…é¡»æä¾›å…·ä½“çš„æ–¹æ³•å®ç°

```rust
pub trait Test {
  fn test1(&self) -> String;
  fn test2(&self) -> String;
}

fn main() {}
```

## åœ¨ç±»å‹ä¸Šå®ç° Trait

ä¸ä¸ºç±»å‹å®ç°æ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹å°±æ˜¯ `impl XXX for XXX {}`, {}é‡Œè¦å¯¹æ–¹æ³•çš„å®šä¹‰è¿›è¡Œå…·ä½“çš„å®ç°

```rust
// src/lib.rs

// äººæˆ–åŠ¨ç‰©çš„æè¿°ä¿¡æ¯
pub trait Description {
  fn description(&self) -> String;
}

pub struct People {
  pub name: String,
  pub gender: String,
  pub age: i32,
  pub height: i32,
}

impl Description for People {
  fn description(&self) -> String {
    format!(
      "Student description: name:{}-age:{}-gender:{}-height:{}",
      self.name, self.age, self.gender, self.height
    )
  }
}

pub struct Animal {
  pub name: String,
  pub action: String,
}

impl Description for Animal {
  fn description(&self) -> String {
    format!(
      "Animal description: name:{}-action: {}",
      self.name, self.action
    )
  }
}
```

```rust
// src/main.rs
// è¿™é‡Œçš„ demo æ˜¯ Cargo.toml æ–‡ä»¶é‡Œçš„ [package] çš„ name å€¼
// æŠŠ trait å’Œ struct å¼•å…¥
use demo::Description;
use demo::People;

fn main() {
  let student = People {
    name: String::from("å¤§é”¤"),
    age: 18,
    height: 200,
    gender: String::from("ç”·"),
  };

  // People: Student description: name:å¤§é”¤-age:18-gender:ç”·-height:200
  println!("People: {}", student.description())
}

```

## å®ç° trait çš„çº¦æŸ

å¯ä»¥åœ¨æŸä¸ªç±»å‹ä¸Šå®ç° Trait çš„å‰ææ˜¯ï¼Œè¿™ä¸ªç±»å‹æˆ–è€…è¿™ä¸ª Trait æ˜¯åœ¨æœ¬åœ° crate é‡Œå®šä¹‰çš„ ã€‚

ä¸èƒ½ä¸ºå¤–éƒ¨ç±»å‹æ¥å®ç°å¤–éƒ¨çš„ Traitï¼š

- è¿™ä¸ªé™åˆ¶æ˜¯ç¨‹åºå±æ€§çš„ä¸€éƒ¨åˆ†
- æ›´å…·ä½“è¯´æ˜¯ **å­¤å„¿è§„åˆ™**ï¼Œä¹‹æ‰€ä»¥è¿™æ ·å‘½åæ˜¯å› ä¸ºçˆ¶ç±»å‹ä¸å­˜åœ¨
- è¿™ä¸ªè§„åˆ™èƒ½ç¡®ä¿åˆ«äººä¸èƒ½ç ´åä½ çš„ä»£ç ï¼Œåä¹‹äº¦ç„¶ï¼Œä½ ä¹Ÿä¸èƒ½ç ´ååˆ«äººçš„ä»£ç 
- å¦‚æœæ²¡æœ‰è¿™ä¸ªè§„åˆ™ï¼Œä¸¤ä¸ª crate å¯ä»¥ä¸ºåŒä¸€ä¸ªç±»å‹å®ç°åŒä¸€ä¸ª Traitï¼ŒRust å°±ä¸çŸ¥é“ç”¨å“ªä¸ªå®ç°äº†
- ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¸ºç¬¬ä¸‰æ–¹åº“çš„ç±»å‹æ¥å®ç°ç¬¬ä¸‰æ–¹åº“çš„ Trait

## é»˜è®¤å®ç°

- å°±æ˜¯åœ¨ Trait ä¸­çš„æ–¹æ³•å¯ä»¥ç»™é»˜è®¤çš„å®ç°æ–¹å¼ï¼Œç„¶å impl trait for struct çš„æ—¶å€™ä¸éœ€è¦æ‰‹åŠ¨å»å®ç° Trait çš„æ–¹æ³•

  ```rust
  pub trait Description {
    fn description(&self) -> String {
      String::from("é»˜è®¤å®ç°")
    }
  }

  pub struct People {
    pub name: String,
    pub gender: String,
    pub age: i32,
    pub height: i32,
  }

  impl Description for People {}
  ```

- é»˜è®¤å®ç°çš„æ–¹æ³•ä¹Ÿå¯ä»¥è°ƒç”¨ Trait é‡Œçš„å…¶å®ƒæ–¹æ³•ï¼Œå³ä½¿è°ƒç”¨çš„æ–¹æ³•æ²¡æœ‰é»˜è®¤çš„å®ç°

  ```rust
  pub trait Description {
    fn description(&self) -> String;
    fn default_fn(&self) -> String {
      format!(
        "description and default function test: {}",
        self.description()
      )
    }
  }

  pub struct People {
    pub name: String,
    pub gender: String,
    pub age: i32,
    pub height: i32,
  }

  impl Description for People {
    fn description(&self) -> String {
      // People: æ²¡æœ‰è¿›è¡Œé»˜è®¤å®ç°çš„æ–¹æ³•: å¤§é”¤, 18, ç”·, 200
      format!(
        "æ²¡æœ‰è¿›è¡Œé»˜è®¤å®ç°çš„æ–¹æ³•: {}, {}, {}, {}",
        self.name, self.age, self.gender, self.height
      )
    }
  }
  ```

## æŠŠ Trait ä½œä¸ºå‡½æ•°å‚æ•°

- ä½¿ç”¨ impl trait è¯­æ³•ï¼šé€‚ç”¨äºç®€å•çš„æƒ…å†µ

  ```rust
  pub trait Description {
    fn description(&self) -> String;
    fn default_fn(&self) -> String {
      format!(
        "description and default function test: {}",
        self.description()
      )
    }
  }

  pub struct People {
    pub name: String,
    pub gender: String,
    pub age: i32,
    pub height: i32,
  }

  impl Description for People {
    fn description(&self) -> String {
      // People: æ²¡æœ‰è¿›è¡Œé»˜è®¤å®ç°çš„æ–¹æ³•: å¤§é”¤, 18, ç”·, 200
      format!(
        "æ²¡æœ‰è¿›è¡Œé»˜è®¤å®ç°çš„æ–¹æ³•: {}, {}, {}, {}",
        self.name, self.age, self.gender, self.height
      )
    }
  }

  pub fn test_trait_fn(item: impl Description) {
    println!("{}", item.description())
  }
  ```

- ä½¿ç”¨ Trait bound è¯­æ³•ï¼šé€‚ç”¨äºå¤æ‚çš„æƒ…å†µï¼Œå®é™…å°±æ˜¯æ³›å‹çº¦æŸï¼Œä¸Šé¢é‚£ç§æ–¹å¼å…¶å®å°±æ˜¯è¿™ç§æ–¹å¼çš„è¯­æ³•ç³–

  ```rust
  // ä¸Šé¢çš„é‚£ä¸ªæ–¹æ³•æ”¹å†™æˆè¿™æ ·
  pub fn test_trait_fn<T: Description>(item: T) {
    println!("{}", item.description())
  }
  ```

- å¦‚æœå®ç°äº†å¤šä¸ª Traitï¼Œå¯ä»¥ä½¿ç”¨+å·è¿æ¥

  ```rust
  use std::fmt::Display;

  ......

  pub fn test_trait_fn1(item: impl Description + Display) {
    println!("{}", item.description())
  }

  pub fn test_trait_fn2<T: Description + Display>(item: T) {
    println!("{}", item.description())
  }
  ```

- ä½¿ç”¨ where å­å¥æ¥è¿›è¡Œæ³›å‹çº¦æŸï¼Œä¸Šä¸‹ä¸¤ç§å®ç°æ–¹å¼æ˜¯ç­‰ä»·çš„

  ```rust
  use std::clone::Clone;
  use std::fmt::{Debug, Display};

  // test_trait_fn1 æ–¹æ³•çš„ T ç±»å‹å®ç°äº† Description å’Œ Display ä¸¤ä¸ª Traitï¼ŒUç±»å‹å®ç°äº† Debug å’Œ Clone ä¸¤ä¸ª Trait
  pub fn test_trait_fn1<T: Description + Display, U: Debug + Clone>(item1: T, item2: U) {
    println!("{}", item1.description())
  }

  pub fn test_trait_fn2<T, U>(item1: T, item2: U)
  where
    T: Description + Display,
    U: Debug + Clone,
  {
    println!("{}", item1.description())
  }
  ```

## å®ç°äº†çš„ Trait ä½œä¸ºè¿”å›ç±»å‹

impl trait åªèƒ½è¿”å›ç¡®å®šçš„åŒä¸€ç§ç±»å‹ï¼Œè¿”å›å¯èƒ½å‡ºç°çš„ä¸åŒç±»å‹ä»£ç ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚å‡½æ•°ä¸­åˆ¤æ–­æ­£ç¡®æ—¶è¿”å› Peopleï¼Œé”™è¯¯æ—¶è¿”å› Animal å°±ä¼šæŠ¥é”™ã€‚

```rust
// åªèƒ½è¿”å›å®ç°äº† Description è¿™ä¸ª Trait çš„
pub fn test() -> impl Description {
  People {
    name: String::from("ç‹å¤§é”¤"),
    gender: String::from("ç”·"),
    age: 18,
    height: 200,
  }
}
```

### çœ‹ä¸ªä¾‹å­ï¼Œè·å–æ•°ç»„é‡Œçš„æœ€å¤§çš„ä¸€é¡¹

T æ˜¯å®ç°äº† PartialOrd å’Œ Clone ä¸¤ä¸ª Trait çš„ç±»å‹

```rust
fn largest<T: PartialOrd + Clone>(list: &[T]) -> &T {
  let mut largest = &list[0];

  for item in list.iter() {
    if item > largest {
      largest = item
    }
  }

  largest
}

fn main() {
  let str = vec![String::from("hello"), String::from("world")];
  let res = largest(&str);

  println!("Largest is {}", res)
}
```

## ä½¿ç”¨ Trait Bound æœ‰æ¡ä»¶çš„å®ç°æ–¹æ³•

- åœ¨ä½¿ç”¨æ³›å‹ç±»å‹å‚æ•°çš„ impl å—ä¸Šä½¿ç”¨ Trait boundï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ¡ä»¶çš„ä¸ºå®ç°äº†ç‰¹å®š Trait çš„ç±»å‹æ¥å®ç°æ–¹æ³•ã€‚ä¸‹é¢è¿™æ®µä»£ç çš„æ„æ€å°±æ˜¯å¯¹äº Pair æ¥è¯´ï¼Œä¸è®º T æ˜¯ä»€ä¹ˆç±»å‹çš„æ—¶å€™éƒ½ä¼šæœ‰ new è¿™ä¸ªæ–¹æ³•ï¼Œè€Œåªæœ‰ T çš„ç±»å‹æ˜¯ PartialOrd å’Œ Display çš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šæœ‰ cmp_display è¿™ä¸ªæ–¹æ³•ã€‚

  ```rust
  use std::fmt::Display;

  struct Pair<T> {
    x: T,
    y: T,
  }

  impl<T> Pair<T> {
    fn new(x: T, y: T) -> Self {
      Self { x, y }
    }
  }

  impl<T: PartialOrd + Display> Pair<T> {
    fn cmp_display(&self) {
      if (self.x > self.y) {
        println!("x > y")
      } else {
        println!("x < y")
      }
    }
  }

  fn main() {}
  ```

- ä¹Ÿå¯ä»¥ä¸ºå®ç°äº†å…¶å®ƒ Trait çš„ä»»æ„ç±»å‹æœ‰æ¡ä»¶çš„å®ç°æŸä¸ª Trait

- ä¸ºæ»¡è¶³ Trait Bound çš„æ‰€æœ‰ç±»å‹ä¸Šå®ç° Trait å«åšè¦†ç›–å®ç°ã€‚

## å¸¸ç”¨ Trait

- Clone / Copy traitï¼Œçº¦å®šäº†æ•°æ®è¢«æ·±æ‹·è´å’Œæµ…æ‹·è´çš„è¡Œä¸ºï¼›
- Read / Write traitï¼Œçº¦å®šäº†å¯¹ I/O è¯»å†™çš„è¡Œä¸ºï¼›
- Iteratorï¼Œçº¦å®šäº†è¿­ä»£å™¨çš„è¡Œä¸ºï¼›
- Debugï¼Œçº¦å®šäº†æ•°æ®å¦‚ä½•è¢«ä»¥ debug çš„æ–¹å¼æ˜¾ç¤ºå‡ºæ¥çš„è¡Œä¸ºï¼›
- Defaultï¼Œçº¦å®šæ•°æ®ç±»å‹çš„ç¼ºçœå€¼å¦‚ä½•äº§ç”Ÿçš„è¡Œä¸º;
- From / TryFromï¼Œçº¦å®šäº†æ•°æ®é—´å¦‚ä½•è½¬æ¢çš„è¡Œä¸ºã€‚

## å†…å­˜ Trait

Clone / Copy / Drop

## æ ‡è®° Ttrait

Sized / Send / Sync / Unpin

Sized - ç”¨äºæ ‡è®°æœ‰å…·ä½“å¤§å°çš„ç±»å‹ã€‚åœ¨ä½¿ç”¨æ³›å‹å‚æ•°æ—¶ï¼ŒRust ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºæ³›å‹å‚æ•°åŠ ä¸Š Sized çº¦æŸã€‚åœ¨å°‘æ•°æƒ…å†µä¸‹ï¼Œéœ€è¦ T æ˜¯å¯å˜ç±»å‹çš„ï¼ŒRust æä¾›äº† ?Sized æ¥æ‘†è„±è¿™ä¸ªçº¦æŸã€‚

```rust
struct Data<T> {
    inner: T,
}

fn process_data<T>(data: Data<T>) {
    todo!();
}

// ç­‰ä»·äº ğŸ‘‡


struct Data<T: Sized> {
    inner: T,
}

fn process_data<T: Sized>(data: Data<T>) {
    todo!();
}
```

Send/Sync æ˜¯ Rust å¹¶å‘å®‰å…¨çš„åŸºç¡€ï¼š

- å¦‚æœä¸€ä¸ªç±»å‹ T å®ç°äº† Send traitï¼Œæ„å‘³ç€ T å¯ä»¥å®‰å…¨åœ°ä»ä¸€ä¸ªçº¿ç¨‹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æƒå¯ä»¥åœ¨çº¿ç¨‹é—´ç§»åŠ¨ã€‚
- å¦‚æœä¸€ä¸ªç±»å‹ T å®ç°äº† Sync traitï¼Œåˆ™æ„å‘³ç€ &T å¯ä»¥å®‰å…¨åœ°åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«ã€‚ä¸€ä¸ªç±»å‹ T æ»¡è¶³ Sync traitï¼Œå½“ä¸”ä»…å½“ &T æ»¡è¶³ Send traitã€‚
- å¦‚æœä¸€ä¸ªç±»å‹ T: Sendï¼Œé‚£ä¹ˆ T åœ¨æŸä¸ªçº¿ç¨‹ä¸­çš„ç‹¬å è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›
- å¦‚æœä¸€ä¸ªç±»å‹ T: Syncï¼Œé‚£ä¹ˆ T åœ¨çº¿ç¨‹é—´çš„åªè¯»å…±äº«æ˜¯å®‰å…¨çš„ã€‚

å¯¹äºè‡ªå·±å®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœå…¶å†…éƒ¨çš„æ‰€æœ‰åŸŸéƒ½å®ç°äº† Send / Syncï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®ç»“æ„ä¼šè¢«è‡ªåŠ¨æ·»åŠ  Send / Sync ã€‚åŸºæœ¬ä¸ŠåŸç”Ÿæ•°æ®ç»“æ„éƒ½æ”¯æŒ Send / Syncï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»å¤§å¤šæ•°è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„éƒ½æ˜¯æ»¡è¶³ Send / Sync çš„ã€‚

æ ‡å‡†åº“ä¸­ï¼Œä¸æ”¯æŒ Send / Sync çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰ï¼š

- è£¸æŒ‡é’ˆ *const T / *mut Tã€‚å®ƒä»¬æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æ—¢ä¸æ˜¯ Send ä¹Ÿä¸æ˜¯ Syncã€‚
- UnsafeCell ä¸æ”¯æŒ Syncã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•ä½¿ç”¨äº† Cell æˆ–è€… RefCell çš„æ•°æ®ç»“æ„ä¸æ”¯æŒ Syncã€‚
- å¼•ç”¨è®¡æ•° Rc ä¸æ”¯æŒ Send ä¹Ÿä¸æ”¯æŒ Syncã€‚æ‰€ä»¥ Rc æ— æ³•è·¨çº¿ç¨‹ã€‚

trait Unpinï¼Œæ˜¯ç”¨äºè‡ªå¼•ç”¨ç±»å‹çš„

## ç±»å‹è½¬æ¢ Trait

From\<T> / Into\<T> / AsRef\<T> / AsMut\<T>

å¯¹å€¼ç±»å‹çš„è½¬æ¢å’Œå¯¹å¼•ç”¨ç±»å‹çš„è½¬æ¢ï¼ŒRust æä¾›äº†ä¸¤å¥—ä¸åŒçš„ traitï¼š

- å€¼ç±»å‹åˆ°å€¼ç±»å‹çš„è½¬æ¢ï¼šFrom / Into / TryFrom / TryInto

  ```rust
  pub trait From<T> {
      fn from(T) -> Self;
  }

  pub trait Into<T> {
      fn into(self) -> T;
  }

  // åœ¨å®ç° From çš„æ—¶å€™ä¼šè‡ªåŠ¨å®ç° Into

  impl<T, U> Into<U> for T where U: From<T> {
      fn into(self) -> U {
          U::from(self)
      }
  }
  ```

  å¦‚æœæ•°æ®ç±»å‹åœ¨è½¬æ¢è¿‡ç¨‹ä¸­æœ‰å¯èƒ½å‡ºç°é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨ TryFrom å’Œ TryIntoï¼Œç”¨æ³•å’Œ From / Into ä¸€æ ·ï¼Œåªæ˜¯ trait å†…å¤šäº†ä¸€ä¸ªå…³è”ç±»å‹ Errorï¼Œä¸”è¿”å›çš„ç»“æœæ˜¯ Resultã€‚

- å¼•ç”¨ç±»å‹åˆ°å¼•ç”¨ç±»å‹çš„è½¬æ¢ï¼šAsRef / AsMut

  ```rust
  pub trait AsRef<T> where T: ?Sized {
      fn as_ref(&self) -> &T;
  }

  pub trait AsMut<T> where T: ?Sized {
      fn as_mut(&mut self) -> &mut T;
  }
  ```

## æ“ä½œç¬¦ Trait

Deref / DerefMut

æ¯”å¦‚ Add traitï¼Œå®ƒå…è®¸ä½ é‡è½½åŠ æ³•è¿ç®—ç¬¦ã€‚Rust ä¸ºæ‰€æœ‰çš„è¿ç®—ç¬¦éƒ½æä¾›äº† traitï¼Œä½ å¯ä»¥ä¸ºè‡ªå·±çš„ç±»å‹é‡è½½æŸäº›æ“ä½œç¬¦ã€‚

```rust
pub trait Deref {
    // è§£å¼•ç”¨å‡ºæ¥çš„ç»“æœç±»å‹
    type Target: ?Sized;
    fn deref(&self) -> &Self::Target;
}

pub trait DerefMut: Deref {
    fn deref_mut(&mut self) -> &mut Self::Target;
}

// ç”¨äºä¸ºç±»å‹æä¾›ç¼ºçœå€¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ derive å® #[derive(Default)] æ¥å®ç°ï¼Œå‰ææ˜¯ç±»å‹ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½å®ç°äº†Default trait
pub trait Default {
    fn default() -> Self;
}
```

## å…¶å®ƒ Trait

Debug / Display / Default

```rust
pub trait Debug {
    fn fmt(&self, f: &mut Formatter<'_>) -> Result<(), Error>;
}

pub trait Display {
    fn fmt(&self, f: &mut Formatter<'_>) -> Result<(), Error>;
}
```
