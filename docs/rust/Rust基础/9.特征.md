## ç‰¹å¾ç®€ä»‹

æœ‰ç‚¹åƒ TS çš„ interface æ¥å£ï¼Œä¸€èˆ¬ç”¨äºå®šä¹‰ä¸€ä¸ªç»“æ„ä½“å…·æœ‰çš„æ–¹æ³•æˆ–å®ç°ã€‚åƒä¸‹é¢è¿™æ ·çš„å†™æ³•å°±æ˜¯ Rust çš„ç‰¹å¾

```rust
trait Weather {
    fn get_today_weather() {}
}
```

## å¸¸ç”¨ Trait

- Clone / Copy traitï¼Œçº¦å®šäº†æ•°æ®è¢«æ·±æ‹·è´å’Œæµ…æ‹·è´çš„è¡Œä¸ºï¼›
- Read / Write traitï¼Œçº¦å®šäº†å¯¹ I/O è¯»å†™çš„è¡Œä¸ºï¼›
- Iteratorï¼Œçº¦å®šäº†è¿­ä»£å™¨çš„è¡Œä¸ºï¼›
- Debugï¼Œçº¦å®šäº†æ•°æ®å¦‚ä½•è¢«ä»¥ debug çš„æ–¹å¼æ˜¾ç¤ºå‡ºæ¥çš„è¡Œä¸ºï¼›
- Defaultï¼Œçº¦å®šæ•°æ®ç±»å‹çš„ç¼ºçœå€¼å¦‚ä½•äº§ç”Ÿçš„è¡Œä¸º;
- From / TryFromï¼Œçº¦å®šäº†æ•°æ®é—´å¦‚ä½•è½¬æ¢çš„è¡Œä¸ºã€‚

## æ ‡è®° Ttrait

### Sized

Sized - ç”¨äºæ ‡è®°æœ‰å…·ä½“å¤§å°çš„ç±»å‹ã€‚åœ¨ä½¿ç”¨æ³›å‹å‚æ•°æ—¶ï¼ŒRust ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºæ³›å‹å‚æ•°åŠ ä¸Š Sized çº¦æŸã€‚åœ¨å°‘æ•°æƒ…å†µä¸‹ï¼Œéœ€è¦ T æ˜¯å¯å˜ç±»å‹çš„ï¼ŒRust æä¾›äº† ?Sized æ¥æ‘†è„±è¿™ä¸ªçº¦æŸã€‚

```rust
struct Data<T> {
    inner: T,
}

fn process_data<T>(data: Data<T>) {
    todo!();
}

// ç­‰ä»·äº ğŸ‘‡


struct Data<T: Sized> {
    inner: T,
}

fn process_data<T: Sized>(data: Data<T>) {
    todo!();
}
```

### Send/Sync

Send/Sync æ˜¯ Rust å¹¶å‘å®‰å…¨çš„åŸºç¡€ï¼š

- å¦‚æœä¸€ä¸ªç±»å‹ T å®ç°äº† Send traitï¼Œæ‰€æœ‰æƒå¯ä»¥åœ¨çº¿ç¨‹é—´ç§»åŠ¨ã€‚
- å¦‚æœä¸€ä¸ªç±»å‹ T å®ç°äº† Sync traitï¼Œ &T å¯ä»¥å®‰å…¨åœ°åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«ã€‚ä¸€ä¸ªç±»å‹ T å®ç°äº† Sync traitï¼Œåˆ™ &T è‚¯å®šä¹Ÿæ»¡è¶³ Send traitã€‚
- å¦‚æœä¸€ä¸ªç±»å‹ T: Sendï¼Œé‚£ä¹ˆ T åœ¨æŸä¸ªçº¿ç¨‹ä¸­çš„**ç‹¬å è®¿é—®**æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›
- å¦‚æœä¸€ä¸ªç±»å‹ T: Syncï¼Œé‚£ä¹ˆ T åœ¨çº¿ç¨‹é—´çš„**åªè¯»**å…±äº«æ˜¯å®‰å…¨çš„ã€‚



å¯¹äºè‡ªå·±å®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœå…¶å†…éƒ¨çš„æ‰€æœ‰åŸŸéƒ½å®ç°äº† Send / Syncï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®ç»“æ„ä¼šè¢«è‡ªåŠ¨æ·»åŠ  Send / Sync ã€‚åŸºæœ¬ä¸ŠåŸç”Ÿæ•°æ®ç»“æ„éƒ½æ”¯æŒ Send / Syncï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»å¤§å¤šæ•°è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„éƒ½æ˜¯æ»¡è¶³ Send / Sync çš„ã€‚

æ ‡å‡†åº“ä¸­ï¼Œä¸æ”¯æŒ Send / Sync çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰ï¼š

- è£¸æŒ‡é’ˆ *const T / *mut Tã€‚å®ƒä»¬æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æ—¢ä¸æ˜¯ Send ä¹Ÿä¸æ˜¯ Syncã€‚
- UnsafeCell ä¸æ”¯æŒ Syncã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•ä½¿ç”¨äº† Cell æˆ–è€… RefCell çš„æ•°æ®ç»“æ„ä¸æ”¯æŒ Syncã€‚
- å¼•ç”¨è®¡æ•° Rc ä¸æ”¯æŒ Send ä¹Ÿä¸æ”¯æŒ Syncã€‚æ‰€ä»¥ Rc æ— æ³•è·¨çº¿ç¨‹ã€‚

### Pin/Unpin

trait Unpin(std::marker::Unpin)ï¼Œå‡ ä¹æ¯ç§ç±»å‹éƒ½è‡ªåŠ¨å®ç°äº†è¿™ä¸ª traitï¼Œ**PhantomPinned**ï¼Œç¼–è¯‘å™¨ä¸ºasync/await desugar ä¹‹åç”Ÿæˆçš„`impl Future`çš„ç»“æ„ä½“é™¤å¤–ã€‚ä¸ä¹‹å¯¹åº”çš„æ˜¯ Pin(è¿™æ˜¯ä¸ªæ™ºèƒ½æŒ‡é’ˆ)ï¼Œå®ƒå†…éƒ¨åŒ…è£¹äº†å¦å¤–ä¸€ä¸ªæŒ‡é’ˆ**P**ï¼Œå¹¶ä¸”åªè¦**P**æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼ˆæˆ‘ä»¬ç§°ä¸º**T**ï¼‰æ²¡æœ‰å®ç°**Unpin**  (!Unpin)ï¼Œåˆ™å¯ä»¥ä¿è¯**T**æ°¸è¿œä¸ä¼šè¢«ç§»åŠ¨ï¼ˆmoveï¼‰

```rust
pub auto trait Unpin { }
```

```rust
#[derive(Copy, Clone)]
pub struct Pin<P> {
    pointer: P,
}
```

å…³äº Pin API çš„ä¸€äº›ä¿¡æ¯

> - å¦‚æœ T: Unpin(é»˜è®¤å®ç°)ï¼Œç„¶åç”¨ Pin<'a, T> ï¼Œå…¶å®ç°å’Œ &'a mut T ä¸€æ ·ï¼Œæ¢å¥è¯æ¥è¯´ï¼Œåªè¦å®ç°äº† Unpinï¼Œé‚£ä¹ˆä½ å°± Pin ä¸ä½å®ƒäº†ï¼Œç»™ä¸€ä¸ªå®ç°äº† Unpin trait çš„ç±»å‹ç”¨ Pin åŒ…è£¹æ²¡ä»»ä½•æ•ˆæœã€‚
> - å¦‚æœ T å®ç°äº† !Unpinï¼Œå°†ä¸€ä¸ªå¯å˜å¼•ç”¨ &mut T å˜æˆä¸€ä¸ª Pin ä½çš„ T è¦æ±‚ä½¿ç”¨ unsafe
> - å¤§å¤šæ•°æ ‡å‡†åº“çš„ç±»å‹éƒ½å®ç°äº† Unpinï¼Œ**PhantomPinned**ï¼Œç¼–è¯‘å™¨ä¸º async/await desugar ä¹‹åç”Ÿæˆçš„`impl Future`çš„ç»“æ„ä½“é™¤å¤–ã€‚
> - åœ¨ nightly ç‰ˆæœ¬ï¼Œä½ å¯ä»¥é€šè¿‡ feature flag å¢åŠ ä¸€ä¸ª !Unpin çº¦æŸåˆ°ä¸€ä¸ªç±»å‹ï¼Œæˆ–è€…åœ¨ç¨³å®šç‰ˆæœ¬ä¸­ï¼Œå¢åŠ  std::marker::PhantomPinned åˆ°ä½ çš„ç±»å‹ä¸­
> - ä½ å¯ä»¥æŠŠæ•°æ® pin åˆ°æ ˆä¸Šæˆ–è€…å †ä¸Š
> - Pin ä¸€ä¸ªå®ç°äº† !Unpin çš„æ•°æ®åˆ°æ ˆä¸Šéœ€è¦ä½¿ç”¨ unsafe
> - Pin ä¸€ä¸ªå®ç°äº† !Unpin çš„æ•°æ®åˆ°å †ä¸Šç›´æ¥ä½¿ç”¨ Box::pin å³å¯ï¼Œä¸éœ€è¦ unsafe
> - å¯¹äº Pin ä½å®ç°äº† T: !Unpin  çš„æ•°æ®ï¼Œä½ å¿…é¡»ä¿è¯ä»å®ƒå¼€å§‹åˆ°è¢« drop è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå…¶åœ¨å†…å­˜ä¸­ä¸ä¼šå¤±æ•ˆæˆ–è¢«é‡æ–°åˆå§‹åŒ–

## æ“ä½œç¬¦ Trait

Deref / DerefMut

æ“ä½œç¬¦è¿˜æœ‰åŠ å‡ä¹˜é™¤ç­‰ï¼Œæ¯”å¦‚ Add traitï¼Œå®ƒå…è®¸ä½ é‡è½½åŠ æ³•è¿ç®—ç¬¦ã€‚Rust ä¸ºæ‰€æœ‰çš„è¿ç®—ç¬¦éƒ½æä¾›äº† traitï¼Œä½ å¯ä»¥ä¸ºè‡ªå·±çš„ç±»å‹é‡è½½æŸäº›æ“ä½œç¬¦ã€‚

```rust
pub trait Deref {
    // è§£å¼•ç”¨å‡ºæ¥çš„ç»“æœç±»å‹
    type Target: ?Sized;
    fn deref(&self) -> &Self::Target;
}

pub trait DerefMut: Deref {
    fn deref_mut(&mut self) -> &mut Self::Target;
}

// ç”¨äºä¸ºç±»å‹æä¾›ç¼ºçœå€¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ derive å® #[derive(Default)] æ¥å®ç°ï¼Œå‰ææ˜¯ç±»å‹ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½å®ç°äº†Default trait
pub trait Default {
    fn default() -> Self;
}
```

## å…¶å®ƒ

Debug / Display ï¼Œç”¨äºè°ƒè¯•å’Œåœ¨æ ‡å‡†è¾“å‡ºæ‰“å°çš„ trait

```rust
pub trait Debug {
    fn fmt(&self, f: &mut Formatter<'_>) -> Result<(), Error>;
}

pub trait Display {
    fn fmt(&self, f: &mut Formatter<'_>) -> Result<(), Error>;
}
```

